<html>
  <head>
  </head>
<body bgcolor="#555555">
  <table border=1><tr><td>
    <svg id="main" width="900" height="500" xmlns="http://www.w3.org/2000/svg">
      <circle id="redcircle" cx="5" cy="5" r="9" fill="red" />
  </svg>
</table>

<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.2.5/svg.min.js"></script -->
<script src="/home/strick/git/cayley_dickson/svg.min.225.js"></script>

<script type="text/javascript" charset="utf-8">
function getViewport() {

 var viewPortWidth;
 var viewPortHeight;

 // the more standards compliant browsers (mozilla/netscape/opera/IE7) use window.innerWidth and window.innerHeight
 if (typeof window.innerWidth != 'undefined') {
   viewPortWidth = window.innerWidth,
   viewPortHeight = window.innerHeight
 }

// IE6 in standards compliant mode (i.e. with a valid doctype as the first line in the document)
 else if (typeof document.documentElement != 'undefined'
 && typeof document.documentElement.clientWidth !=
 'undefined' && document.documentElement.clientWidth != 0) {
    viewPortWidth = document.documentElement.clientWidth,
    viewPortHeight = document.documentElement.clientHeight
 }

 // older versions of IE
 else {
   viewPortWidth = document.getElementsByTagName('body')[0].clientWidth,
   viewPortHeight = document.getElementsByTagName('body')[0].clientHeight
 }
 return [viewPortWidth, viewPortHeight];
}
</script>



<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
<script type="text/javascript" charset="utf-8">
if (!SVG.supported) {
  alert('Your browser does not support SVG.')
}

// Global Geometry.
GW = 900
GH = 500
NB = 4
GSetupTime = 400
D = 500
Ghead = 50  // header message
Gfoot = 450  // footer message
Gbut = Gfoot = 300 // footer buttons
GdispX = 50   // Main display.
GdispY = 100
GheliX = 700  // Helipad location.
GheliY = GdispY+20
GdispTab = 250
GdispGap = 50
GdispV = 50  // Vertical display gap

// create svg drawing paper
var G = SVG('main').size(GW, GH)

// Create display.
Display = G.group().move(-200, -200)
Display.animate(GSetupTime).move(GdispX, GdispY)
Display.rect(800, 150).fill('#8f8')

// create buttons
Buttons = {}
FillActiveButton = '#fff'
FillPassiveButton = '#0cc'

CurrentCards = ['b', 'c', 'd', 'd']
Chosen = null
Negs = 0
NegsW = {}
function BuildButtons() {
  Chosen = -1  // None chosen yet.  Remove old buttons.
  for (var i=0; i<NB; i++) { if (i in Buttons) Buttons[i].remove() }
  //for (i in Buttons) { Buttons[i].remove() }

  for (var i=0; i<NB; i++) {
    // The button group
    var b = G.group().move(i * 200 + 100, Gbut)
    Buttons[i] = b

    // The blue/white rectangle.
    var br = b.rect(100, 100)
         .fill(FillPassiveButton)
         .mouseover(function() { this.fill(FillActiveButton) })
         .mouseout (function() { if (this.i != Chosen) {this.fill(FillPassiveButton)} })
    br.i = i

    // The letter.
    var bt = b.text(CurrentCards[i])
         .move(50, 0)
         .leading(1.1)
         .font({ family: 'Helvetica', size: 80, anchor: 'middle'})
         .mouseover(function() { this.parent().first().fill(FillActiveButton) })
         .mouseout (function() { if (this.i != Chosen) this.parent().first().fill(FillPassiveButton) })
    bt.i = i

    b.move(i * 200 + 100, GH)  // Arise from below.
    b.animate(GSetupTime).move(i * 200 + 100, Gbut)

    // Construct the ClickFn.
    ;(function (bb, ii) {
      ClickFn = (function() {
        Chosen = ii
        bb.first().fill(FillActiveButton)
        bb.animate(GSetupTime).move(GheliX, GheliY).after(Leapfrog)
      })
    })(b, i)
    br.click(ClickFn)
    bt.click(ClickFn)
  }
}

Letters = [ '1' ]
Letters = [ 'a', 'b', 'c', 'd', 'e' ]
Minuses = [ ]
Shuttle = null
LettersW = {}

function RenderLetters() {
  var i
  for (i=0; i<LettersW.length; i++) {
    if (i in LettersW) { LettersW[i].remove() }
  }
  LettersW = []
  for (i=0; i<Letters.length; i++) {
    LettersW.push(
      G.text(Letters[i])
        .move(GdispX + GdispTab + i*GdispGap, GdispY+GdispV)
        .leading(1.1)
        .font({family: 'Helvetica', size: 80, anchor: 'left'})
    )
  }
}

Leaper = null
function Leapfrog() {
  var c = CurrentCards[Chosen]
  Leaper = G.text(c)
         .move(GheliX, GdispY+GdispV)
         .leading(1.1)
         .font({family: 'Helvetica', size: 80, anchor: 'left'})

  Buttons[Chosen].first().next().remove()  // Remove letter from heliport.

  var ll = Letters.length 
  chain = []
  if (Letters[0]=='1') {
    // Special case for '1'.
    Leaper.animate(D).move(GdispX + GdispTab, GdispY+0*GdispV).after(function() {
      LettersW[0].animate(D).move(GdispX + GdispTab, GH)
    })
    newLetters = [c]
  } else {
    // Figure out where the letter drops.
    for (var i = ll-1; i>=0; i--) {
      var d = Letters[i]
      var negative = false
      if (d <= c) {
        break  // Found the right place.
      } else {
        negative = true
        // Letter moves right, out of the way.
        ;(function(i2){
          chain.push(function(){return LettersW[i2].animate(D).move(GdispX + GdispTab + (i2+1)*GdispGap, GdispY+GdispV)})
        })(i)
      }
      ;(function(i2){
        // Leaper moves.
        chain.push(function(){return Leaper.animate(D).move(GdispX + GdispTab + (i2)*GdispGap, GdispY+0*GdispV)})
      })(i)
      if (negative) {
        Negs ++
        ;(function(i2, negs2){
            // Dash flies.
            var signX = GdispX + GdispTab - negs2 * GdispGap
            chain.push(function(){
              NegsW[negs2] = G.text('-')
                   .move(GdispX + GdispTab + (i2+0)*GdispGap, GdispY+0*GdispV)
                   .leading(1.1)
                   .font({family: 'Helvetica', size: 80, anchor: 'left'})
              return NegsW[negs2].animate(D).move(signX, GdispY+GdispV)
            })
        })(i, Negs)
      }
    }

    // Annihilate?
    if (c == d) {
      Negs ++

      ;(function(i2, negs2){
        // d moves up to meet
        chain.push(function(){return LettersW[i2].animate(D).move(GdispX + GdispTab + (i2+0)*GdispGap, GdispY)})
    
        // Dash files out.
        chain.push(function(){
          NegsW[negs2] = G.text('-')
               .move(GdispX + GdispTab + (i2+0)*GdispGap, GdispY+0*GdispV)
               .leading(1.1)
               .font({family: 'Helvetica', size: 80, anchor: 'left'})

          var signX = GdispX + GdispTab - negs2 * GdispGap
          return NegsW[negs2].animate(D).move(signX, GdispY+GdispV)
        })

        chain.push(function(){
          Leaper.animate(D).move(GdispX + GdispTab + (i2+1)*GdispGap, -100)
          return LettersW[i2].animate(D).move(GdispX + GdispTab + (i2+0)*GdispGap, -100)
        })

        if (i2+1 < ll) {
          chain.push(function(){
            var z = null
            for (j=i2+1; j<ll; j++) {
              // Slide back 2 into place.
              z = LettersW[j].animate(D).move(GdispX + GdispTab + (j-1)*GdispGap, GdispY+GdispV)
            }
            return z
          })
        }

      })(i, Negs)

      newLetters = []
      for (var j=0; j<i; j++) {
        newLetters.push(Letters[j])
      }
      for (var j=i+1; j<ll; j++) {
        newLetters.push(Letters[j])
      }
    } else {
      // No annihilation.
      newLetters = []
      for (var j=0; j<i; j++) {
        newLetters.push(Letters[j])
      }
      newLetters.push(c)
      for (var j=i; j<ll; j++) {
        newLetters.push(Letters[j])
      }
    }
  }

  // Tear off pairs of minuse.
  while (Negs > 1) {
    ;(function(negs2){
      chain.push(function(){
        var signX = GdispX + GdispTab - (negs2-1) * GdispGap
        NegsW[negs2-1].animate(D).move(signX, -100)
        var signX = GdispX + GdispTab - negs2 * GdispGap
        return NegsW[negs2].animate(D).move(signX, -100)
      })
    })(Negs)
    Negs -= 2
  }

  chain.push(function(){
    // Reset & Reactivate as final thing.
    Letters = newLetters
    BuildButtons()
    RenderLetters()
  })

  var fn = null
  for (var i = chain.length-1; i>=0; i--) {
    if (fn) {
      (function(i2, fn2){
        fn = (function(){return chain[i2]().after(fn2) })
      })(i, fn)
    } else {
      fn = chain[i]
    }
  }
  if (fn) {fn()}
}

BuildButtons()
RenderLetters()


</script>
